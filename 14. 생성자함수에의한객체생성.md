# Object 생성자 함수
- new 연산자와 Object 생성자함수 호출로 빈 객체 생성 후 반환
- 생성자함수 constructor : new 연산자와 호출하여 객체(인스턴스) 생성하는 함수
- Object, String, Number, Booleanm Function, Array, Date, RegExp, Promise 등의 빌트인 생성자함수 있음

<br></br>

## 생성자 함수
- 객체리터럴에 의한 객체 생성방식의 문제점
    - 직관적, 간편 but 하나의 객체만 생성
    - so 동일한 프로퍼티를 갖는 여러개의 객체 생성시 비효율적
- 생성자함수에 의한 객체 생성박식의 장점
    - 파이썬의 클래스처럼 동작하여 프로퍼티 구조가 동일한 객체를 여러개 양산가능
    - 이때 자기참조변수(self-referencing variable) **this** 는 객체 자신의 프로퍼티나 메서드를 참조한다
    - 이 참조값 this 바인딩은 함수 호출방식에의해 동적으로 결정
- new 연산자와 함께 호출하지않으면, 일반함수로 동작함을 주의하자

<table>
  <thead>
    <tr>
      <th style="text-align: left">함수 호출 방식</th>
      <th style="text-align: left">this가 가리키는 값(this 바인딩)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">일반 함수로서 호출</td>
      <td style="text-align: left">전역 객체</td>
    </tr>
    <tr>
      <td style="text-align: left">메서드로서 호출</td>
      <td style="text-align: left">메서드를 호출한 객체(마침표 앞의 객체)</td>
    </tr>
    <tr>
      <td style="text-align: left">생성자 함수로서 호출</td>
      <td style="text-align: left">생성자 함수가 (미래에) 생성할 인스턴스</td>
    </tr>
  </tbody>
</table>

<br></br>

---

- 생성자 함수의 인스턴스 생성과정
    - 생성자함수의 역할 = 인스턴스생성 + 생성된인스턴스 초기화(옵션)
    - 이때 인스턴스의 생성과 반환은 자바스크립트엔진이 암묵적처리
    1. 인스턴스 생성과 this 바인딩
        - 암묵적으로 빈 객체생성 -> 빈객체가 this에 바인딩 (런타임 전에)
        - 바인딩 : 식별자와 값을 연결하는것
    2. 인스턴스 초기화
        - 함수 몸체의 코드가 실행되며 this에 바인딩된 인스턴스를 초기화
    3. 인스턴스 반환
        - 함수 내부의 모든 처리 후 완성된 인스턴스가 바인딩된 this가 암묵적 반환됨
        - 만약 this가 아닌 다른객체를 명시적으로 반환하면 return 문에 명시한 객체가 반환(이때 명시한객체가 원시값이라면? 무시되고 this 반환)
        - 한마디로 생성자함수 내부에서 명시적으로 this 이외의 값을 반환하는 return문은 반드시 생략
---
- 내부메서드 [[Call]]과 [[Construct]]
    - 함수선언문,함수표현식으로 정의한 함수 는 일반적인 함수로, 생성자함수로 모두 호출가능
    - 함수=객체 즉 일반객체 ordinary object와 동일하게 동작가능
        - 내부슬롯과 내부메서드를 가지고있기 때문
    - But 일반객체와 다르게 함수는 호출가능
        - 일반객체의 내부슬롯과 내부메서드 + 함수객체만을위한 내부슬롯(Environment,FormalParameters)과 내부메서드(Call,Construct)들을 추가로 가지고있음
        - 함수가 일반함수로 호출 : 함수 객체의 내부메서드 [[Call]]호출
        - new 연산자와 생성자함수로 호출 : 내부메서드 [[Construct]] 호출

- 내부메서드 [[Call]] 가짐 : callable
    - callable : 호출가능한 객체, 즉 함수 
- 내부메서드 [[Construct]] 가짐 : constructor
    - constructor : 생성자함수로서 호출할수 있는 함수
- [[Constructor]] 가지지않음 : non-constructor
    - non-constructor : 객체를 생성자 함수로서 호출할수 없는 함수

- 호출할수없는 객체? = 함수객체가 아님, 즉 함수객체는 무조건 callable([[Call]] 내부메서드 가짐)
    - But 모든 함수객체가 [[Constructor]]가지진 않음
    - **함수객체는 constructor non-constructor 모두 가능하다**
    - 모든 함수객체는 호출할수 있지만, 모든함수가 생성자 함수로서 호출할수있는건 아니다
---
- constructor와 non-constructor 구분
    - 자바스크립트엔진은 함수 정의방식에따라 함수구분
    - constructor : 함수선언문, 함수표현식, 클래스
    - non-constructor : 메서드(ES6 축약표현), 화살표함수
    - 이때 일반함수(callable, constructor)에 new 연산자를 붙여 호출하면 생성자함수처럼 동작할수 있다는것을 주의
---
- new 연산자
    - new 연산자와 호출되는 함수는 constructor 여야함을 기억
    - new 연산자 없이 호출하면 일반함수로 호출(Constructor 대신 Call 호출)
    - 생성자함수는 일반적으로 PascalCase로 명명하여 일반함수과 구분
- new.target ES6
    - this와 유사하게 constructor인 함수내부에서 암묵적 지역변수처럼 사용됨
        - 메타프로퍼티 라고 불림(IE는 new.target 미지원)
    - 함수내부에서 new.target 사용시 new연산자와 함께 생성자함수로 호출되었는지 여부 확인
        - 함께호출되었다면 함수자신을, new연산자없이호출됬다면 undefined
```
// 생성자 함수
function Circle(radius) {
  // 이 함수가 new 연산자와 함께 호출되지 않았다면 new.target은 undefined다.
  if (!new.target) {
    // new 연산자와 함께 생성자 함수를 재귀 호출하여 생성된 인스턴스를 반환한다.
    return new Circle(radius);
  }

  this.radius = radius;
  this.getDiameter = function () {
    return 2 * this.radius;
  };
}

// new 연산자 없이 생성자 함수를 호출하여도 new.target을 통해 생성자 함수로서 호출된다.
const circle = Circle(5);
console.log(circle.getDiameter());
```
---
- 스코프세이프 생성자패턴 scope-safe constructor
    - new.target이 사용불가능한 IE 환경에서 대체방법으로 사용
```
// Scope-Safe Constructor Pattern
function Circle(radius) {
  // 생성자 함수가 new 연산자와 함께 호출되면 함수의 선두에서 빈 객체를 생성하고
  // this에 바인딩한다. 이때 this와 Circle은 프로토타입에 의해 연결된다.

  // 이 함수가 new 연산자와 함께 호출되지 않았다면 이 시점의 this는 전역 객체 window를 가리킨다.
  // 즉, this와 Circle은 프로토타입에 의해 연결되지 않는다.
  if (!(this instanceof Circle)) {
    // new 연산자와 함께 호출하여 생성된 인스턴스를 반환한다.
    return new Circle(radius);
  }

  this.radius = radius;
  this.getDiameter = function () {
    return 2 * this.radius;
  };
}

// new 연산자 없이 생성자 함수를 호출하여도 생성자 함수로서 호출된다.
const circle = Circle(5);
console.log(circle.getDiameter()); // 10
```

- 대부분의 빌트인 생성자 함수(Object, String, Number, Boolean, Function, Array, Date, RegExp, Promise 등)는 new 연산자와 함께 호출되었는지를 확인한 후 적절한 값을 반환
    - Object와 Function 생성자 함수는 new 연산자 없이 호출해도 new 연산자와 함께 호출했을 때와 동일하게 동작
    - String, Number, Boolean 생성자 함수는 new 연산자와 함께 호출했을 때 String, Number, Boolean 객체를 생성하여 반환
        - new 연산자 없이 호출하면 문자열, 숫자, 불리언 값을 반환(데이터 타입 변환)